|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| # Redis Tech Dive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Redis (stands for **Re**mote **Di**ctionary **S**erver) is an open source key-value store that’s commonly used as a database, cache, message broker, and much more. It’s been optimized to be fast and highly scalable but also be versatile and support a variety of different use cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| It was first released in 2009 and has since gained adoption at every major tech company and at many startups.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Some of the characteristics of Redis are                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| - **In-Memory with Optional Durability** - Redis uses RAM as the primary storage for the database’s items. Reading/writing data to RAM can be thousands of times faster than HDD access.  <br>      <br>    The obvious downside is that you’ll lose all your data if someone trips over the server’s power cable. For this, Redis offers optional durability where you can write the state of your Redis database to disk.<br>    <br>- **Key-Value with Rich Data Structures** - Redis is a key value store, where your keys are strings. For the value, Redis offers a variety of data structures like strings, sets, sorted sets, bitmaps, geospatial indexes and more. Each of these data structures comes with specific operations like union/intersection (for sets), geo-search (for geospatial indexes) and more.<br>    <br>- **Easy Horizontal Scalability** - There’s obviously a limit to the amount of memory you can stuff into a single machine. Redis Cluster gives you a way to easily run a setup where data is automatically sharded across multiple Redis nodes. |
| We’ll delve into each of these in much more depth.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ## **History of Redis**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Redis was created by Salvatore Sanfilippo (also known by his username and blog - _[antirez](https://link.mail.beehiiv.com/ss/c/u001.HemypDdL66N2rXUmw8SIa4MKtiOQsS8qxg-D56pCtujbj4uBdrz1UmiWn_0rwqoMgmQKxTTntWNC93BrajpbgeFh_xDhlECeakOdy-fxNqa-7CqRdIMobbL68CLNRkpN31Vmz4cErzLuQq6cvH8KH6LXSMGuhwSIBAGbaTX2xws/49x/uLLi8skJQvCyWf5UlwJnEg/h30/h001.aJ5u4hnIbDnqnN9G2gKuR3CgFZE_tOgkZr9-fm59QEo)_) in the late 2000s. At the time, he was building a startup to help website owners get visibility into what their users were doing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| A site owner could use their tool to see what users were reading, what pages they were clicking to, etc. All this data was available _in real time_.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| The issue was with scaling the data store. Salvatore was originally trying to use MySQL but ran into performance issues. MySQL relies on the hard disk for primary storage, so HDD read/write speeds were becoming a bottleneck.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Instead, he created LMDB, an in-memory, key value database that relied on RAM instead of HDD. The MVP was just 300 lines long, but supported commands like SET/GET with support for strings and lists as data types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| In 2009, it was launched on [Hacker News](https://link.mail.beehiiv.com/ss/c/u001.yJG48nE5ZcIpUsUtBqoWTOzdW5b8jNB4zJWdLuXpd79Y3MPDnq3U7U3Lo1IS64MK-6Tlqmta2jawrEj9BGgDc9yJBLI5LnLs_d21uzhlCgiLvLtYygXvQm0rlqAUPwWajtoK6JkaK7BVIKqbGFtqSMxaDKVUHieF-eHc-DCBgEJLkfcBMLIHalI_yiD6W_l3/49x/uLLi8skJQvCyWf5UlwJnEg/h31/h001.-4uxIisbS57f_CG5eihd3KZ_nGOwEUM7H1HiCU7AQDs) and received the typical HN reaction of “_hey, this has already been done_”.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| By 2010, both Twitter and Instagram had adopted Redis. VMWare became the first major sponsor of the project.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| As Redis gained adoption, many companies formed to offer consulting services around the database. One of these was Redis Labs. Antirez (Salvatore) ended up joining Redis Labs and the company became the official sponsor of the project.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Antirez maintained a role as the BDFL (Benevolent Dictator For Life) of the project until 2020, when he stepped down. Redis now has a governance model of people from Redis Labs and also other core community members.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| You can read a much more detailed look at the history of Redis from this fantastic article [here](https://link.mail.beehiiv.com/ss/c/u001.8dFPyTsecDoXHzJV_U5eqqRPzW5dtGAq7Wq6xYuBXfCvUah8p6HIJ-EsccFgISWNp2Ilw6W37rTKnCH2jlHGdm5CLy4bFy3xl9k8OKJvl1cMzBm24rFDAGo2zP5E5-z_B8d8pMPZttd3SJSfZ1clEoo-4oDMdfQ0HdFAOInPesvfrfyRux2tjDKpM01YrRGP/49x/uLLi8skJQvCyWf5UlwJnEg/h32/h001.5rYsYC8_lg-bsljZGXZupbDiWYLf_1sofvrtOoe4qkU).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ## **Database Overview**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Redis is a key value store (_sorry for repeating this for the 10th time_) so the most basic operations are GET/SET for getting the value of a specific key and also setting the value for a key.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Keys are strings but the value can be represented by a variety of different data structures. The core data structures are strings, lists, sets, hashes, sorted sets, streams, geospatial indexes, bitmaps, bitfields and hyperloglog.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| If you’re using Redis, it’s crucial to have a solid understanding of the different data structures and their tradeoffs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ### Strings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| The most basic data type for your value, it can store any sequence of bytes. The maximum size of a value string is 512 MB.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Methods include SET/GET. You also have methods to increment the string if the string value can be converted to a number.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ### Lists                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Redis also supports lists of strings with their List data structure. Lists are implemented internally with Linked Lists, so you can add to the left and right of a Redis List in constant time. However, retrieving elements from a List takes linear time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Methods include LPUSH to add an element to the left (the front) of the list. RPUSH to add an element to the right (the end) of the list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| You can also do things like get an element at a certain index, get a range of elements,  and [more](https://link.mail.beehiiv.com/ss/c/u001.B2haaCyK5UgXQ2XrPU3qa-5hU8mS4zH_39QepdF7t6Dk_BuuChRGga9ObcZlCU546q8ECnG1ZyVu1faPDpDZ42OTqSSPcwi6THBEyKV4kZbHmcrr_Jk0Z3y1Q8Tm9EaOXM91HPLWwN83qL3FVLJ9sw2qR3Z7LANEbccc657nc62HaYRMqfuNxUiROUvgOj8f/49x/uLLi8skJQvCyWf5UlwJnEg/h33/h001.VdRSp5XmGOew_lTkt36aGwY7OSRPLHXhb8IV_paMvY0).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ### Bitmaps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| In a previous Quastor article, we talked about how Grab scaled their [user segmentation platform](https://link.mail.beehiiv.com/ss/c/u001.GaP25kixWOTuE1E3XPYxBU_OsWHl6cPIFET3BSRK1bTDVTWhasze6c8dEit5PYwDEh-iQiBPDsaeYvRNjub6aWRTKkyvPxXOcsIMHaybC320ybv4kVOHaszOg6rVm4vvcTxgLHb6clMd-kCi6q8Vsfx_9xKhxHaSdhIgs2L4CXi2NBUqOUjL_sVWs7x39jFNE4uvZzvgmoI40gyyb4AfPaG2JRkTdHUqxaBNwiuQj9E/49x/uLLi8skJQvCyWf5UlwJnEg/h34/h001.pXjJCBnoXW_t40Y0ue626I_O7L6iG-dDTB7VcJ2diOU). One of the key challenges they had was scaling the write throughput.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| They need to store a large set of user IDs (_represented as integers_) and check if a certain user ID was in a segment. They accomplished this by representing the user IDs in a [bitmap](https://link.mail.beehiiv.com/ss/c/u001.B2haaCyK5UgXQ2XrPU3qa1zzCEE7rADSgMRtzwoPGNNiFzhGmPnTmsw_tWCTbFRJa3w78EBuwLAS4VTo5xg0Pdsww6IMJIC-aQ9Y0vqDliwS3emAPUxypcZk7Rr8jYQaJO2UdYr_jCV1JGBEzZGRIJ38Y3bN_rjR2OTitIeHfBc/49x/uLLi8skJQvCyWf5UlwJnEg/h35/h001.IgjimXublQxfJTdKLKmOoLkH54qEmzlZfsJ53dUUGsE) where you do a bitwise operation to check if the bit at the user ID’s index is 0 or 1. Bitmaps are also commonly used as a [database index](https://link.mail.beehiiv.com/ss/c/u001.GaP25kixWOTuE1E3XPYxBYaNyUGZyVKJhuXIbGlJOOKd3odPvyycmSa2vgwz5tPls5PmTERpm1cvBBYvckWdlTLUg03rPWG2AY9MKFBvAnQFhpuTrCitssttpsGABw2udDKcIayZu9qF3aY9gSsy6fH2ZAAwlMceFphiA1UulhQWUufHH7n3pt6hEkoH8Glt/49x/uLLi8skJQvCyWf5UlwJnEg/h36/h001.B28aNJ3xqdbRkWYOVZ4jdRrclI414GOtux-r3D49pCs).                                                                                                                 |
| Bitmaps can be _extremely_ efficient to work with. Both time and space complexity scale at a constant factor.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| In Redis, Bitmaps are a special application of the string data structure, but each bit in the string is considered a separate value (either a 0 or a 1).  <br>  <br>Redis strings can be up to 512 MB in size, so a Bitmap value type can contain up to 4 billion bits (512 megabytes _1024 kb in 1 megabyte_ 1024 bytes in 1 kb * 8 bits in 1 byte).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| You have operations like SETBIT and GETBIT to set/get the value of a bit at a specific offset. You can also use BITCOUNT to count the number of set bits (bits with a value of 1) in the bitmap over a given range.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ### HyperLogLog                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| HyperLogLog is a _probabilistic_ data structure that lets you keep track of the number of unique elements in a dataset in an extremely efficient, fast way. The downside is HyperLogLog provides an estimated count rather than an exact one (the accuracy is very high, with less than a 1% standard error).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| It’s very useful for real-time analytics. Maybe you want to count the number of users who’ve downloaded each image on your website. You might have millions of images, so using an HLL could be an efficient way to keep track of this.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Whenever a user downloads an image for the first time, you use the PFADD function to add them to the HLL. If you want to get the number of unique users who’ve been added to the HLL, you can use the PFCOUNT command.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| _This is an excerpt from our Tech Dive on Redis for Quastor Pro readers._                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| _We also talk about the other Redis data structures (Sets, Hashes, Bitfields, etc.), Redis’s options for persistence (RDB and AOF) and their trade-offs, real world use cases and more._                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
